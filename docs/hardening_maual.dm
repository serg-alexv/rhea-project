Hardening# Rhea Ops Hardening ‚Äî Single-File Field Manual
*–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å. ‚ÄúBank-level —Å–∫—É–∫–∞‚Äù, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–∏—è—Ç–Ω–æ —ç–∫—Å–ø–ª—É–∞—Ç–∏—Ä–æ–≤–∞—Ç—å.*

> –¶–µ–ª—å: —Ç—ã –º–æ–∂–µ—à—å **—É–±–∏–≤–∞—Ç—å/–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å** –∞–≥–µ–Ω—Ç–æ–≤ (Rex/B2/Argos/etc.) –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ —Ç–µ–∫—É—â–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –∏ –±–µ–∑ ‚Äú–∑–æ–º–±–∏-—ç—Ñ—Ñ–µ–∫—Ç–æ–≤‚Äù, –∞ –æ—Ñ–∏—Å –ø–æ–ª—É—á–∞–µ—Ç **–¥–æ–∫–∞–∑—É–µ–º—ã–µ** —Å–ª–µ–¥—ã —Ä–∞–±–æ—Ç—ã (receipts, hashes, incidents).

---

## 0) –ü—Ä–∏–Ω—Ü–∏–ø: –Ω–µ ‚Äú—Å–µ—Å—Å–∏—è‚Äù, –∞ ‚Äú—Å–µ—Ä–≤–∏—Å‚Äù
–°–µ—Å—Å–∏–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ ‚Äî —ç—Ç–æ **–∫—ç—à**. –û–Ω–∏ —É–º–∏—Ä–∞—é—Ç, –∫–æ–º–ø–∞–∫—Ç—É—é—Ç—Å—è, –∏—Å—á–µ–∑–∞—é—Ç, –∏ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.
–ü—Ä–æ–¥-–ø–æ–¥—Ö–æ–¥: –∞–≥–µ–Ω—Ç ‚Äî —ç—Ç–æ **systemd service** + **durable state** + **deterministic boot**.

**–ö–ª—é—á–µ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞:**
> Context durability = Capsule + Seq + Catch-up + Lease/Fencing + Outbox/Receipts

---

## 1) –ì–ª–∞–≤–Ω—ã–µ —Ä–∏—Å–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –∑–∞–∫—Ä—ã–≤–∞–µ–º
### R1 ‚Äî –ü–æ—Ç–µ—Ä—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
–¢–µ—Ä–º–∏–Ω–∞–ª —É–º–µ—Ä / SSH –æ—Ç–≤–∞–ª–∏–ª—Å—è / Claude Code –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è ‚Üí –ø–∞–º—è—Ç—å —Å–µ—Å—Å–∏–∏ –∏—Å—á–µ–∑–ª–∞.

**–ó–∞—â–∏—Ç–∞:** Capsule + Boot catch-up + logs.

### R2 ‚Äî –ó–æ–º–±–∏-–∞–≥–µ–Ω—Ç –∏ –¥–≤–æ–π–Ω—ã–µ side-effects
–°—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å ‚Äú–ø—Ä–æ—Å–Ω—É–ª—Å—è‚Äù –∏ —Å–¥–µ–ª–∞–ª git push / –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É, –ø–æ–∫–∞ –Ω–æ–≤—ã–π —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–ó–∞—â–∏—Ç–∞:** Lease + fencing token + executor rejects stale tokens.

### R3 ‚Äî –î—É–±–ª–∏ –∏–∑-–∑–∞ —Ä–µ—Ç—Ä–∞–µ–≤
–°–µ—Ç—å/–∫–≤–æ—Ç—ã ‚Üí –ø–æ–≤—Ç–æ—Ä ‚Üí –¥–≤–æ–π–Ω–æ–π –∫–æ–º–º–∏—Ç.

**–ó–∞—â–∏—Ç–∞:** idempotency_key + effect_intents + receipts.

### R4 ‚Äî ‚ÄúSTOP –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª‚Äù
–ú–æ–¥–µ–ª—å ‚Äú–æ—Ç–∫–∞–∑–∞–ª–∞—Å—å‚Äù, –Ω–æ –≤–æ—Ä–∫–µ—Ä –ø—Ä–æ–¥–æ–ª–∂–∏–ª –≤—ã–ø–æ–ª–Ω—è—Ç—å.

**–ó–∞—â–∏—Ç–∞:** STOP file + lease revoke + hard gating before effects.

---

## 2) –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Ç (P0)
**P0 = must-have, –∏–Ω–∞—á–µ –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –∫–æ—Å–º–µ—Ç–∏–∫–∞**

1) **Rex State Capsule** (–º–∞–ª—ã–π boot-—Å–Ω–∏–º–æ–∫)  
2) **Deterministic Boot Script** (load ‚Üí catch-up ‚Üí drain relay ‚Üí run)  
3) **systemd wrapper** (restart policy + sandbox + logs)  
4) **Idempotent outbox –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤** (—Ö–æ—Ç—è –±—ã –¥–ª—è git)  
5) **Kill switch** (STOP file)  

---

## 3) Rex State Capsule (durable boot anchor)
### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ù–µ –∞—Ä—Ö–∏–≤, –Ω–µ ‚Äú–∏—Å—Ç–æ—Ä–∏—è‚Äù ‚Äî **—è–∫–æ—Ä—å —Å—Ç–∞—Ä—Ç–∞**, —á—Ç–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–±–æ—á–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ—Å–ª–µ –ª—é–±—ã—Ö –æ–±—Ä—ã–≤–æ–≤.

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ñ–∞–π–ª
- `capsules/rex_state_capsule.json`

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (v1)
- `schema_version`
- `agent_id`
- `runpoint_id`
- `last_seq_applied`
- `provider_state` (degraded_mode, –ø—Ä–∏—á–∏–Ω–∞)
- `pointers` (–≥–¥–µ —Å–æ–±—ã—Ç–∏—è/–ø–æ—á—Ç–∞/leases/snapshots)
- `constraints` (STOP path, ‚Äúlease before effects‚Äù)

### –ü—Ä–∞–≤–∏–ª–∞ –∫–∞–ø—Å—É–ª—ã
- **–º–∞–ª–µ–Ω—å–∫–∞—è** (–∫–∏–ª–æ-–±–∞–π—Ç—ã, –Ω–µ –º–µ–≥–∞–±–∞–π—Ç—ã)
- –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ (`write tmp -> rename`)
- –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è:
  - –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –±–∞—Ç—á–∞ catch-up
  - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –≤ run loop (–∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç / N —Å–æ–±—ã—Ç–∏–π)
  - –Ω–∞ SIGTERM best-effort

---

## 4) Boot Script (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–∞—Ä—Ç)
### –¶–µ–ª—å
–ü–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –∞–≥–µ–Ω—Ç **–¥–æ–≥–æ–Ω—è–µ—Ç –∏—Å—Ç–∏–Ω—É** (events/relay) –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç.

### –ê–ª–≥–æ—Ä–∏—Ç–º (–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π)
1) –ï—Å–ª–∏ STOP file —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí **–Ω–µ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å**
2) Load capsule
3) Acquire/verify lease token (fencing)
4) Load snapshot (–µ—Å–ª–∏ –µ—Å—Ç—å)
5) Catch-up: –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Å–æ–±—ã—Ç–∏—è `seq > last_seq_applied` –¥–æ –∫–æ–Ω—Ü–∞
6) Drain mailbox/relay –ø–æ `seq` (ordered)
7) –ü–µ—Ä–µ–¥ –ª—é–±—ã–º –æ–ø–∞—Å–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º:
   - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å lease_token –∞–∫—Ç—É–∞–ª–µ–Ω
   - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å TTL/staleness policy
   - —Å–æ–∑–¥–∞—Ç—å effect_intent –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
8) –ó–∞–ø–∏—Å–∞—Ç—å snapshot/capsule
9) –ü–µ—Ä–µ–π—Ç–∏ –≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π run loop (listener + periodic snapshot)

**–°–º—ã—Å–ª:** listener ‚Äî —Ç–æ–ª—å–∫–æ ‚Äúlive mode‚Äù. –ò—Å—Ç–∏–Ω–∞ ‚Äî –¥–æ–≥–æ–Ω –ø–æ seq.

---

## 5) STOP semantics (STOP means STOP)
### –ú–µ—Ö–∞–Ω–∏–∫–∞
- `./STOP` (–∏–ª–∏ –¥—Ä—É–≥–æ–π –ø—É—Ç—å) ‚Äî —Ñ–∞–π–ª-–ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å, –ø–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏.
- STOP –¥–æ–ª–∂–µ–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
  - –æ—Ç–∑—ã–≤–∞—Ç—å lease
  - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—Ç—å –Ω–æ–≤—ã–µ effect_intents

### Best practice
- –í–µ–∑–¥–µ –ø–µ—Ä–µ–¥ –æ–ø–∞—Å–Ω—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º: `if STOP present: abort`
- –í systemd: `ExecStartPre` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç STOP –∏ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç –≤ —Å—Ç–∞—Ä—Ç–µ

---

## 6) Outbox –¥–ª—è side-effects (–º–∏–Ω–∏–º—É–º –¥–ª—è git)
### –ü–æ—á–µ–º—É
–ï—Å–ª–∏ –∞–≥–µ–Ω—Ç —É–ø–∞–ª ‚Äú–º–µ–∂–¥—É‚Äù –ø—Ä–∏–Ω—è—Ç–∏–µ–º —Ä–µ—à–µ–Ω–∏—è –∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º ‚Äî –±–µ–∑ outbox —Ç—ã —Ç–µ—Ä—è–µ—à—å –ª–∏–±–æ –¥–µ–π—Å—Ç–≤–∏–µ, –ª–∏–±–æ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

### –ü—Ä–∞–≤–∏–ª–æ
–ê–≥–µ–Ω—Ç **–Ω–µ –¥–µ–ª–∞–µ—Ç** side-effect –Ω–∞–ø—Ä—è–º—É—é.
–û–Ω –ø–∏—à–µ—Ç `effect_intents/{intent_id}` —Å `idempotency_key` –∏ `lease_token`.

–û—Ç–¥–µ–ª—å–Ω—ã–π executor –∏—Å–ø–æ–ª–Ω—è–µ—Ç –∏ –ø–∏—à–µ—Ç receipt:
- `commit_sha`
- `response_hash`
- `artifact_hash`

---

## 7) Lease + Fencing tokens (anti-zombie)
### –ò–¥–µ—è
–õ—é–±–æ–π –≤–æ—Ä–∫–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π `lease_token`.  
–í—Å–µ —ç—Ñ—Ñ–µ–∫—Ç—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ —Å **—Ç–µ–∫—É—â–∏–º** —Ç–æ–∫–µ–Ω–æ–º.

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞
- Rex –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ: –ø–æ–ª—É—á–∞–µ—Ç `lease_token=N`
- –õ—é–±–æ–π effect_intent –ø–æ–º–µ—á–∞–µ—Ç—Å—è `lease_token=N`
- Executor –æ—Ç–≤–µ—Ä–≥–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã (–∑–æ–º–±–∏ –Ω–µ –º–æ–≥—É—Ç –ø—É—à–∏—Ç—å)

---

## 8) systemd wrapper (core hardening)
### –ó–∞—á–µ–º
- –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
- –ª–æ–≥–∏ –≤ journal
- –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (`start/stop/restart`)
- –∏–∑–æ–ª—è—Ü–∏—è (sandbox)

### –ì–µ–Ω–µ—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π unit template
–°–æ–∑–¥–∞–π: `/etc/systemd/system/rhea-agent@.service`

```ini
[Unit]
Description=Rhea Agent (%i)
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=agent
WorkingDirectory=/opt/rhea-project

# Global kill-switch: refuse to start if STOP exists
ExecStartPre=/bin/bash -lc 'test ! -f ./STOP'

# Boot sequence (capsule + catch-up + drain relay)
ExecStart=/usr/bin/python3 -m rex_boot --capsule capsules/%i_state_capsule.json --agent %i

Restart=always
RestartSec=3

KillSignal=SIGTERM
TimeoutStopSec=20

StandardOutput=journal
StandardError=journal

# Sandbox (tighten carefully)
NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=full
ProtectHome=true
ReadWritePaths=/opt/rhea-project

Environment=PYTHONUNBUFFERED=1
Environment=RHEA_AGENT_ID=%i

[Install]
WantedBy=multi-user.target


sudo systemctl daemon-reload
sudo systemctl enable --now rhea-agent@Rex.service

sudo systemctl status rhea-agent@Rex.service
sudo journalctl -u rhea-agent@Rex.service -n 200 -f
sudo systemctl restart rhea-agent@Rex.service



9) Terminal survivability (–∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤)

–î–∞–∂–µ —Å systemd –∏–Ω–æ–≥–¥–∞ —Ö–æ—á–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º.

–ú–∏–Ω–∏–º—É–º
	‚Ä¢	tmux/screen –¥–ª—è –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è SSH —Ä–∞–∑—Ä—ã–≤–æ–≤
	‚Ä¢	script -f –∏–ª–∏ tmux pipe-pane –¥–ª—è –ª–æ–≥–æ–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

–ü—Ä–∏–º–µ—Ä:
tmux new -s rex
script -f logs/rex_terminal_$(date -u +%Y%m%dT%H%M%SZ).log


10) Logging & redaction (—á—Ç–æ–±—ã –Ω–µ —É—Å—Ç—Ä–æ–∏—Ç—å self-own)

–ó–∞–ø—Ä–µ—â–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å:
	‚Ä¢	—Ç–æ–∫–µ–Ω—ã/–∫–ª—é—á–∏
	‚Ä¢	Authorization headers
	‚Ä¢	–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ URLs —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏

–ü—Ä–∞–∫—Ç–∏–∫–∞
	‚Ä¢	—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π redaction —Ñ–∏–ª—å—Ç—Ä (regex –ø–æ *_TOKEN|*_KEY|Authorization|Bearer)
	‚Ä¢	–æ—Ç–¥–µ–ª—å–Ω—ã–π ‚Äúsecure log‚Äù —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö
	‚Ä¢	—Ö—Ä–∞–Ω–∏—Ç—å ‚Äúreceipts‚Äù –∏ ‚Äúhashes‚Äù –≤–º–µ—Å—Ç–æ —Å—ã—Ä—ã—Ö payload‚Äô–æ–≤ –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

‚∏ª

11) Fancy bonuses (single-file edition üòè)

–ü–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–æ –æ–¥–∏–Ω —Ñ–∞–π–ª-–º–∞–Ω—É–∞–ª, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å ‚Äú–ø—Ä–∏—è—Ç–Ω—ã–µ –±–æ–Ω—É—Å—ã‚Äù, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∑–∫–æ –ø–æ–≤—ã—à–∞—é—Ç –ø–æ–ª–µ–∑–Ω–æ—Å—Ç—å:

Bonus A ‚Äî Operator Runbook (–æ–¥–Ω–æ –æ–∫–Ω–æ, –±–µ–∑ –ø–∞–Ω–∏–∫–∏)

–í –∫–æ–Ω—Ü–µ —Ñ–∞–π–ª–∞ –¥–µ—Ä–∂–∏ ‚Äú–ø–∞–Ω–∏–∫-—Å–µ–∫—Ü–∏—é‚Äù:
	‚Ä¢	‚ÄúAgent –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç‚Äù ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å STOP, –∂—É—Ä–Ω–∞–ª, –ø—Ä–∞–≤–∞, —Å–µ—Ç—å
	‚Ä¢	‚ÄúQuota wall‚Äù ‚Üí –≤–∫–ª—é—á–∏—Ç—å degraded mode, –æ—á–µ—Ä–µ–¥—å –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å
	‚Ä¢	‚Äú–î—É–±–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤‚Äù ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å idempotency_key, receipts mapping

Bonus B ‚Äî Compliance-lite: termination proofs

–û–ø–∏—à–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç ‚Äúreceipt artifact‚Äù:
	‚Ä¢	commit SHA
	‚Ä¢	content hash
	‚Ä¢	intent_id
	‚Ä¢	lease_token
–≠—Ç–æ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ª—é–±–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤ –¥–æ–∫–∞–∑—É–µ–º–æ–µ.

Bonus C ‚Äî Chaos checklist (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)

–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –ø—Ä–æ–≥–æ–Ω:
	‚Ä¢	kill -9 ‚Üí restart ‚Üí no loss
	‚Ä¢	split brain ‚Üí no zombie effects
	‚Ä¢	STOP mid-run ‚Üí no new intents
–≠—Ç–æ –ø–æ—á—Ç–∏ –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è ‚Äú—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç –±—É–¥—É—â–∏—Ö —Å—é—Ä–ø—Ä–∏–∑–æ–≤‚Äù.

Bonus D ‚Äî Minimal SLOs (—á—Ç–æ–±—ã –ø—Ä–æ–¥–∞–≤–∞—Ç—å)

–ü—Ä—è–º–æ –≤ —Ñ–∞–π–ª:
	‚Ä¢	RTO (–≤—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞) ‚â§ X –º–∏–Ω—É—Ç
	‚Ä¢	RPO (–ø–æ—Ç–µ—Ä—è —Å–æ–±—ã—Ç–∏–π) = 0
	‚Ä¢	Duplicate effects = 0
–ü–æ—Ç–æ–º —ç—Ç–æ –ª–æ–∂–∏—Ç—Å—è –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–µ–∑ –≤—ã–¥—É–º–æ–∫.

‚∏ª

12) Definition of Done (–±–µ–∑ —Å–∞–º–æ–æ–±–º–∞–Ω–∞)

–°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è ‚Äú—É—Å–∏–ª–µ–Ω–Ω–æ–π‚Äù, –µ—Å–ª–∏:
	‚Ä¢	–º–æ–∂–Ω–æ —É–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∞–≥–µ–Ω—Ç–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å ‚Äî –æ–Ω –ø—Ä–æ–¥–æ–ª–∂–∏—Ç –ø–æ seq –±–µ–∑ –ø–æ—Ç–µ—Ä—å
	‚Ä¢	STOP –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—Ä–µ—â–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç—ã
	‚Ä¢	–Ω–∏ –æ–¥–∏–Ω —ç—Ñ—Ñ–µ–∫—Ç –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–≤–∞–∂–¥—ã (receipts + idempotency)
	‚Ä¢	–∑–æ–º–±–∏-–ø—Ä–æ—Ü–µ—Å—Å –Ω–µ —Å–ø–æ—Å–æ–±–µ–Ω –ø—É—à–∏—Ç—å/–ø–∏—Å–∞—Ç—å –ø–æ—Å–ª–µ revoke lease
	‚Ä¢	–∂—É—Ä–Ω–∞–ª –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –ø–æ–∑–≤–æ–ª—è—é—Ç –æ–±—ä—è—Å–Ω–∏—Ç—å ‚Äú—á—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ –∏ –ø–æ—á–µ–º—É‚Äù

‚∏ª

13) –ù–µ –¥–µ–ª–∞–π —ç—Ç–æ–≥–æ (—Ç–∏–ø–∏—á–Ω—ã–µ –ª–æ–≤—É—à–∫–∏)
	‚Ä¢	–ù–µ —Ö—Ä–∞–Ω–∏ ‚Äú–∏—Å—Ç–∏–Ω—É‚Äù –≤ UI/extension/localStorage
	‚Ä¢	–ù–µ –ø–æ–ª–∞–≥–∞–π—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ Firestore listeners (–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω catch-up by seq)
	‚Ä¢	–ù–µ –¥–∞–≤–∞–π –∞–≥–µ–Ω—Ç—É root —Ä–∞–¥–∏ ‚Äú—Å–∫–æ—Ä–æ—Å—Ç–∏‚Äù
	‚Ä¢	–ù–µ –∏—Å–ø–æ–ª–Ω—è–π —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –º–æ–∑–≥–æ–≤–æ–≥–æ –∫–æ–¥–∞
	‚Ä¢	–ù–µ —Å–º–µ—à–∏–≤–∞–π runpoints –±–µ–∑ –∂—ë—Å—Ç–∫–æ–π –∏–∑–æ–ª—è—Ü–∏–∏

‚∏ª

14) –ú–∏–Ω–∏-—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ (–¥–ª—è –∫–æ–º–∞–Ω–¥—ã)
	1.	–í–Ω–µ–¥—Ä–∏—Ç—å template systemd unit
	2.	–î–æ–±–∞–≤–∏—Ç—å STOP file guard + capsule atomic writes
	3.	–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å boot: snapshot ‚Üí catch-up ‚Üí drain relay
	4.	–í—ã–¥–µ–ª–∏—Ç—å effect_intents executor —Ö–æ—Ç—è –±—ã –¥–ª—è git

–≠—Ç–æ –¥–∞—Å—Ç 80% –∑–∞—â–∏—Ç—ã –±—ã—Å—Ç—Ä–æ –∏ –±–µ–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –≤–æ–π–Ω—ã.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, —è –º–æ–≥—É –¥–æ–ø–æ–ª–Ω–∏—Ç—å —ç—Ç–æ—Ç single-file –º–∞–Ω—É–∞–ª –¥–≤—É–º—è ‚Äú–≤—Å—Ç–∞–≤–∫–∞–º–∏‚Äù (—Ç–æ–∂–µ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ):
- **`Troubleshooting: DNS / gRPC / Firestore`** (—á—Ç–æ–±—ã –Ω–µ –ª–æ–≤–∏—Ç—å —Å–Ω–æ–≤–∞ ‚Äú–≤—Å—ë 400‚Äù)  
- **`Security: minimal sudoers policy for agents`** (—á—Ç–æ–±—ã –¥–∞–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –±–µ–∑–æ–ø–∞—Å–Ω–æ)